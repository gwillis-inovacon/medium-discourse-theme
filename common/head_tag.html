<script type="text/discourse-plugin" version="0.8">
  api.onPageChange(() => {
    document.querySelectorAll('.topic-list-item').forEach(item => {
      // Skip if already processed
      if (item.querySelector('.medium-author-line')) return;

      // Find the first avatar
      const avatar = item.querySelector('img.avatar');
      if (!avatar) return;

      // Get username from title (format: "Username - Original Poster, Most Recent Poster")
      const title = avatar.getAttribute('title') || '';
      const username = title.split(' - ')[0].trim();

      // Get category name
      const categoryEl = item.querySelector('.badge-category .category-name, .badge-category');
      const categoryName = categoryEl ? categoryEl.textContent.trim() : '';

      if (username) {
        // Create author line container
        const authorLine = document.createElement('div');
        authorLine.className = 'medium-author-line';

        // Build the content: "Username in Category"
        let html = `<span class="medium-author-name">${username}</span>`;
        if (categoryName) {
          html += `<span class="medium-in-separator"> in </span>`;
          html += `<span class="medium-category-name">${categoryName}</span>`;
        }
        authorLine.innerHTML = html;

        // Insert at the top of the topic list item
        const mainLink = item.querySelector('.main-link, td.main-link');
        if (mainLink) {
          mainLink.insertBefore(authorLine, mainLink.firstChild);
        }
      }
    });
  });
</script>
